# LatteCompiler

This is a compiler of the Latte programming language, whose description can be 
found here: https://www.mimuw.edu.pl/~ben/Zajecia/Mrj2020/Latte/
(in Polish)

## Usage

- To build the project, use the Makefile, ie. run
  ```
  make
  ```

- To verify semantic correctness of a program, run
  ```
  ./latc [FILE.lat]
  ```
  where `FILE.lat` is the file with code you want to verify.
  If the code is correct, the output will be
  ```
  OK
  ```
  If the code is incorrect, the output will be
  ```
  ERROR
  [MSG]
  ```
  where `MSG` is a message specifying what is incorrect about the code.



- You can compile your code to llvm by running
  ```
  ./latc_llvm [FILE].lat
  ```
  where `FILE.lat` is the file with code you want to compile.
  the llvm code will be outputed to a file `FILE.ll` and then linked with 
  `./lib/runtime.ll`. The linked bytecode will be outputed to `FILE.bc`

  You can then run the program using `lli`:
  ```
  lli [FILE].bc
  ```

## Libraries
In this project I use the following non-standard libraries:
- singletons
  
  https://hackage.haskell.org/package/singletons

- dependent-map
  
  https://hackage.haskell.org/package/dependent-map

- some
  
  https://hackage.haskell.org/package/some

## Language Extensions

The following language extensions are implemented:
- arrays and for loops
- structs
- objects
- virtual methods

## Project directory structure:

A file in parenthesis means that it will exist after the project is built.

```
./
|
|- bin
|  | # contains executables called by `latc` and `latc_llvm`
|  |
|  |- (latc_exe)
|  |- (latc_llvm_exe)
|
|- lib
|  |- runtime.ll
|
|- src
|  |- frontend
|  |  |- Main.hs
|  |  |  # compiles to bin/latc_exe - the executable called by ./latc
|  |
|  |- llvm
|  |  |- Main.hs
|  |  |  # compiles to bin/latc_llvm_exe - the executable called by ./latc_llvm
|  |
|  |- src
|  |  |- FromBNFC
|  |  |  |  # contains files generated by BNFC
|  |  |  |
|  |  |  |- AbsLatte.hs
|  |  |  |- ErrM.hs
|  |  |  |- LexLatte.hs
|  |  |  |- ParLatte.hs
|  |  |  |- PrintLatte.hs
|  |  |
|  |  |- LLVM
|  |  |  | # contains code pertaining to llvm code and its generation from 
|  |  |  | # abstract dependent syntax (src/src/Syntax/SyntaxDep.hs)
|  |  |  |
|  |  |  |- Cleanup.hs
|  |  |  |- Convert.hs
|  |  |  |- LLVM.hs
|  |  |  |- LLVMGetters.hs
|  |  |  |- Print.hs
|  |  |  |- State.hs
|  |  |  |- StateUtils.hs
|  |  |  |- TypeConversion.hs
|  |  |
|  |  |- Optimization
|  |  |  |- EvalConstants.hs
|  |  |
|  |  |- Position
|  |  |  | # contains definitions of functions returning position of syntax elements
|  |  |  |
|  |  |  |- EndPosition.hs
|  |  |  |- Position.hs
|  |  |  |- SyntaxDepPosition.hs
|  |  |  |- SyntaxPosition.hs
|  |  |
|  |  |- Syntax
|  |  |  | # contains syntax data definitions and some utils perteining to them
|  |  |  |
|  |  |  |- Bloater.hs
|  |  |  |- Debloater.hs
|  |  |  |- LangElemClasses.hs
|  |  |  |- Syntax.hs
|  |  |  |- SyntaxDep.hs
|  |  |
|  |  |- TypeCheck
|  |  |  | # contains code pertaining to type checking ie. to generation of 
|  |  |  | # dependent abstract syntax (src/src/Syntax/SyntaxDep.hs) from 
|  |  |  | # regular abstract syntax (src/src/Syntax/Syntax.hs)
|  |  |  |
|  |  |  |- Castable.hs
|  |  |  |- CheckReturns.hs
|  |  |  |- Declarations.hs
|  |  |  |- LatteGetters.hs
|  |  |  |- State.hs
|  |  |  |- StateUtils.hs
|  |  |  |- TypeCheck.hs
|  |  |
|  |  |- BuiltIns.hs
|  |  |- Constants.hs
|  |  |- Dependent.hs
|  |  |- Errors.hs
|  |  |- Program.hs
|  |  |- Scope.hs
|  |  |- SingChar.hs
|  |
|  |- latc
|  |  # gets copied to ./latc
|  |
|  |- latc_llvm
|  |  # gets copied to ./latc_llvm
|  |
|  |- latte.cf
|
|- (latc)
|- (latc_llvm)
|- (LatteCompiler.cabal)
|- Makefile
|- package.yaml
|- README.md
|- Setup.hs
|- stack.yaml
|- (stack.yaml.lock)
```
